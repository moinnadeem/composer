---
run_name: bert-baseline
gpu_type: a100_80gb
gpu_num: 8
platform: r1z1
image: mosaicml/moin
integrations:
  - integration_type: "wandb"
    project: bert-pareto-curves
    entity: mosaicml
parameters:
  inherits:
    - model.yaml
  grad_accum: 1
  algorithms:
    act_fn_search:
      use_gated: false
      use_rmsnorm: false
      use_fln: false
      use_triton: false
      act_fn_name: no_replacement
command: >-
  set -e -x

  source ~/env/bin/activate

  pip install wheel

  git clone http://github.com/moinnadeem/composer /root/composer

  cd /root/composer

  pip install xformers

  echo 'Checking out composer branch {{ git_branch }}'

  git checkout moin/cleaned_gated

  pip install -e ".[all]"

  composer -n8 examples/run_composer_trainer.py
  -f /mnt/config/parameters.yaml
